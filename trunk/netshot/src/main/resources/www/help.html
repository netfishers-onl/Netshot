<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<title>Netshot - User guide</title>
	
	<link rel="stylesheet" href="css/normalize.css" />
	<link rel="stylesheet" href="css/common.css" />
	<link rel="stylesheet" href="css/smoothness/jquery-ui.css" />
	<link rel="stylesheet" href="css/help.css" />

	<script data-main="js/loader-help" src="js/libs/require/require.js"></script>
</head>

<body>

<div id="menu">
	<select></select>
</div>

<div id="viewer"></div>

<h1>Netshot user guide</h1>

<div id="page">

<h2 id="overview">Overview</h2>

<p>Netshot is a network device manager.</p>
<p>With Netshot, you can:</p>

<ul>
	<li>Have an operational inventory of your devices.</li>
	<li>Backup device configurations.</li>
	<li>Track the changes on your network.</li>
	<li>Track the IP and MAC addresses of your network devices.</li>
	<li>Track software versions of your devices.</li>
	<li>Track the hardware support of your devices.</li>
	<li>Track the conformance of your devices, based on best-practice or customized policies and rules.</li>
	<li>Script changes on your devices.</li>
	<li>Use the REST API to interact with Netshot from other components or applications.</li>
</ul>

<p>Many of the most used network devices in the world are supported out-of-the-box
and you can easily add your own drivers - this is a simple script file to write.</p>

<h3>Main interface</h3>

<p>Netshot is available through a Web application GUI.</p>

<p>First you have to authenticate. The <a href="#authentication">authentication
settings</a> must have been defined by the administrator.
If nothing has been done since the setup of the database, the default
account is netshot/netshot.</p>

<img alt="Login box" src="img/login.png" class="figure" />

<p>Once logged in, you can start using Netshot. A the top of the page
is the main button bar, which allows you to navigate between the sections.</p>

<p>Click on your login at the right of the page to see your current permission
level. You can also change your password (if using a local account) from this
dialog.</p>

<h2 id="devices">Devices</h2>

<p>Using the Devices section, you can browse the devices that Netshot manage, search for them or their data,
start tasks to refresh their status or configure them, etc.</p>

<p>A <em>device</em> is a network equipment as seen by Netshot. Which type of device is supported
or not by Netshot (vendor, family, collected data, automatic discovery and snapshots) depends entirely on the
loaded <a href="#devicedrivers">device drivers</a>.

<h3>Adding devices</h3>

<p class="note">Before adding any device, you must have created the required <a href="#credentials">credential sets</a>
in the Admin page. You must have a read-write role to be able to add devices.</p>

<p>To add a single device:</p>

<ul>
<li>On the Devices page, click on <em>Add device...</em>.</li>
<li>Select the proper <a href="#devicedomain">domain</a> for the device.</li>
<li>Enter the IP address of the device (or a name that the DNS engine on the Netshot server can resolve).</li>
<li>If you check the <em>Autodiscover device type</em> box, Netshot will start with some SNMP requests
to guess which type of device it is talking to, in which case you must have declared a valid SNMP credential set.
Otherwise you have to select yourself the type of device so Netshot knows which "language" to speak when talking
to the device.</li>
<li>Once the type of device is discovered (either manually or by SNMP polling), the proper driver is assigned,
and Netshot will start a <em>Snapshot</em> task, to capture information about the device (including the current
configuration).</li>
</ul>

<p>To add a bunch of devices:</p>

<ul>
<li>On the Devices page, click on <em>Add device...</em> drop down menu, <em>Scan subnet(s) for devices...</em>
<li>Select the proper <a href="#devicedomain">domain</a> for these devices.</li>
<li>Enter the list of IP addresses (e.g. 1.2.3.4) or IP subnets (e.g. 1.2.3.0/24), one by line and click on <em>Scan</em>.</li>
<li>Netshot will poll each of the IP addresses using the known SNMP credential sets for the domain, and create
devices based on the SNMP responses.</li>
</ul>

<h3 id="devicesearch">Searching for devices</h3>

<p>You can simply find devices based on their name (or virtual name, e.g. VDC), or their IP address:
just type it in the <em>Search...</em> box and type Enter.</p>

<p>To remove the filter, click on the <em>Clear</em> (cross) button.</p>

<p>You can also build advanced searches. Open the <em>Advanced search</em> dialog,
and use the buttons to write a logical search string.
Note that by selecting a type of device, you can filter on the device fields which are specific to this type.</p>

<h3 id="devicegroups">Device groups</h3>

<p>You can create <em>groups</em> of devices.</p>

<p class="note">You must have a read-write role to be able to add, edit or remove groups.</p>

<ul>
<li>You can use groups to easily find/filter your devices.</li>
<li>You can create tasks to run over groups, instead of creating individual tasks.</li>
<li>When creating <a href="#compliance">policies</a>, you have to select a target group.</li>
<li>Some of the <a href="#reports">reports</a> break down data based on the groups.</li>
</ul>

<p>To create a group, click on <em>Add devices...</em> drop down menu, and then on <em>Add a group...</em>
When creating a group, you select the type of group, either static or dynamic (this can't be changed later).
Then edit the group to start adding devices.</p>

<p>Select a group by clicking it in the group tree. The device list will be refreshed, and will display only
the devices contained in the selected group. When a group is selected, the <em>Edit</em> and <em>Delete</em>
buttons appear.</p>

<p>A <em>static</em> group needs each device to be manually selected and added. A <em>dynamic</em> group
is based on a <a href="#devicesearch">search</a> logical expression. Dynamic groups are automatically
refreshed whenever they are edited or devices change.</p>

<p>You can arrange your groups in a hierarchy: enter a folder path, e.g. <code>Backbone A/Core devices/P routers</code>.
This will only affect only how groups will be displayed in the Devices page.</p>

<p>If you check the <em>Hide this groups in reports</em> box, the group can be used as any other group
to filter devices or to apply compliance policies, but it won't appear in the reports.</p>

<p>You can delete a group, by clicking on the <em>ad hoc</em> button. Any associated policy or scheduled task
would be deleted as well.</p>

<h3 id="deviceinfo">Device information</h3>

<p>Click on a device in the left-hand side list to display it.</p>

<img alt="Device general information" src="img/device_general.png" class="figure" />

<p>The <em>General</em> tab gives the following information:</p>

<ul>
<li><em>Name</em>: the hostname of the device, captured by the driver during snapshots.</li>
<li><em>Management IP</em>: the IP address used by Netshot to access the device.</li>
<li><em>Management Domain</em>: the management domain the device belongs to.</li>
<li><em>Location</em>: the physical location of the device, captured by the driver during
snapshots (it is often the SNMP location).</li>
<li><em>Contact</em>: the person or service to contact about the device, captured by
the driver during snapshots (it is often the SNMP contact).</li>
<li><em>Network Class</em>: the category of equipment, among ROUTER, SWITCH, FIREWALL,
LOADBALANCER, etc. as set by the driver during snapshots.</li>
<li><em>Device Type</em>: the type of equipment, i.e. the driver used to talk with
the device. This cannot be changed without deleting the device.</li>
<li><em>Family</em>: the subtype of equipment, set by the driver during snapshots.</li>
<li><em>Software Version</em>: the version of OS for this equipment, set by the driver
during snapshots.</li>
<li><em>Serial Number</em>: the main serial number of the device.</li>
<li><em>Creation Date</em>: when the device was created in Netshot (and the login
who did it).</li>
<li><em>Last Change</em>: when the device was last modified (by a snapshot, or
manually edited).</li>
<li><em>Comments</em>: free text set by manually editing the device, or by
a device script.</li>
<li><em>Member of</em>: the groups the device belongs to.</li>
<li>And additional fields, set at the device level by the specific driver.</li> 
</ul>

<p>The <em>Interfaces</em> and <em>Modules</em> tabs are populated by the device driver
during snapshots. The accuracy of this information will depend on how the specific driver for
this device is coded and what be understood using the CLI of the device.</p>

<h3>Configuration history</h3>

<p>The <em>Configurations</em> tab gives the history of configurations of the device.</p>

<img alt="Configuration changes" src="img/device_config_changes.png" class="figure" />

<p>Which items are contained by a configuration is defined by the device driver. Any information
that may change over the time, and which changes are important to track should be stored there.</p>

<p>Click on a date to see the content of the configuration. Click on the <em>Compare</em> button
to display the differences between two successive configurations, in a new window (ensure your browser
is not blocking popups). Items of the configuration defined as <em>comparable</em> in the device
driver are automatically compared and differences are displayed. You can navigate through
successive changes by using the <em>Previous</em> and <em>Next</em> buttons at the top of the window.
You can also compare two non-successive configurations: drag and drop the date of the two
configuration entries onto the <em>Drop to Diff</em> targets on the right-hand side of the panel.
Then click on the <em>Compare</em> button that should have appeared.</p>

<img alt="Differences between two configurations" src="img/device_config_diff.png" class="figure" />

<p>Long text configuration items, like full running configuration of a Cisco IOS device, can
be displayed in a new window by clicking on the <em>View</em> link, or can be directly downloaded
as a file by using the <em>Download</em> link.</p>

<h3>Device properties</h3>

<p>You can edit some of the properties of the device by clicking on the <em>Edit</em> button
(wrench icon) in the device view toolbar.</p>

<p class="note">You must have a read-write role to be able to edit devices.</p>

<ul>
<li><em>Name</em>: the name of the device can't be edited, it is filled by the device driver during
snapshots.</li>
<li><em>IP address</em>: the management IP address of the device, used by Netshot to access it.
You can change it if for some reason Netshot should use another IP address to administrate the device.</li>
<li><em>Domain</em>: the <a href="#devicedomain">management domain</a> the device belongs to.</li>
<li>You can select which credential set(s) should be used to access the device. If the </li>
<li><em>In case of failure, also try all known credentials</em>: if you check this box, and Netshot
can't connect to the device using the selected credential set(s), other ones will automatically
be tried in turn, if they are associated with the same management domain or with no domain at all.</li>
<li>You can store some free-form text in the <em>Comments</em> box.</li>
</ul>

<p>You can disable a device, by clicking on the relevant button in the device toolbar. No snapshot
task will be executed over a disabled device. Click again on the button to enable the device back.</p>

<h3>Snapshots</h3>

<p class="note">Scheduling snapshot tasks requires read-write permissions.</p>

<p>During a snapshot task, Netshot connects to the device (either by SSH or Telnet, depending
on the available credentials, and also on what the specific <a href="#devicedrivers">driver</a>
supports.</p>

<p>Once connected to the device, Netshot delegates all the snapshot work to the driver.</p>

<img alt="Scheduling a device snapshot" src="img/device_takesnapshot.png" class="figure" />

<ul>
<li>To force a snapshot, click on the <em>Snapshot</em> button in the device view toolbar.</li>
<li>As with any other <a href="#tasks">task</a>, you can schedule repeating snapshots.</li>
<li>You can also schedule or run snapshots onto groups of devices. To do so, click on the
<em>Schedule task...</em> button in the main application toolbar.</li>
<li>If the device supports the sending of specific SNMP traps or syslog messages whenever its
configuration changes, and assuming the driver supports it too, then Netshot can detect the
change and will schedule a snapshot to be automatically taken a few minutes later.
The requirements:
	<ul>
	<li>The device must be configured to send traps or syslog messages to Netshot.</li>
	<li>The <a href="#snmptrapreceiver">SNMP trap receiver</a> or the 
	<a href="#syslogserver">Syslog server</a>must be enabled in Netshot.</li>
	</ul>
</li>
</ul>

<h3 id="devicecompliance">Device compliance</h3>

<p>The <em>Compliance</em> tab of the device view gives the compliance status of the device.
The policies are defined in the <a href="#compliance">Compliance</a> main page.</p>

<img alt="Device compliance" src="img/device_compliance.png" class="figure" />

<p>There are several compliance parts:</p> 
<ul>
<li>Software compliance: the device will be flagged as Gold, Silver or Bronze level,
if a software rule matches or non compliant if there is no match.</li>
<li>Configuration compliance: the table will give the result of each rule when the compliance
check was lastly executed for the device.</li>
<li>Hardware compliance: this gives the computed end of sale and end of life dates.</li>
</ul>

<p class="note">The compliance status of a device is automatically refreshed after each snapshot
however you can force it to be reevaluated by clicking on the <em>Recheck compliance</em> button
and starting the task. This requires read-write role.</p> 

<h3>Device tasks</h3>

<p>In the <em>Taks</em> tab of the device view, you can see the last tasks related to the device.
You can see the details of a finished task, including its logs, and cancel a scheduled task
before it is actually executed.</p>

<h3>Selecting multiple devices</h3>

<p>You can select multiple devices in the device list on the left:</p>

<img alt="Selecting multiple devices" src="img/device_multiple.png" class="figure" />

<ul>
<li>Select a first device, then press the Shift key while clicking on a second device to select
all devices between these two ones.</li>
<li>Select a first device, then press the Ctrl key while clicking on a second device to select
just these two devices.</li>
<li>Click on the <em>Select all devices</em> button (just below the <em>Search</em> box) to
select all the devices currently displayed in the device list.</li>
</ul>

<p>When you select several devices in the device list, you get the <em>Multiple devices selected</em>
panel in the right. There you can do actions that will apply to all selected devices.
However you should note that applying actions to a very high number of devices (e.g. several hundreds
or thousands) can be quite slow.</p>

<p>When scheduling a script to be run over several devices, you have to select the device type (driver)
your script refers to. Only devices of this selected type, among the ones you've selected, will
actually be processed.</p>

<p class="note">Starting actions on multiple devices requires read-write permission level.</p> 

<h3>Running a script</h3>

<p>Device scripts allows you to program commands to be sent to a device or a set of devices.
The scripts are written in Javascript language, which is well documented over the Internet.
Passing simple commands to a network equipment can be done with a few lines only, and doesn't
require real programming skills.</p>

<p>To run a script over a device, click on the <em>Run script</em> icon in the device toolbar.</p>

<img alt="Running a script" src="img/device_runscript.png" class="figure" />

<p class="note">Running scripts requires read-write permissions. Obviously, you have to be very
cautious with the commands you run over your network devices. Netshot won't check anything, it will
simply execute what you write, even if this breaks the target device.</p>

<ul>
<li>The <em>Run script</em> dialog contains a simple Javascript code editor, where you have to put
your Javascript code, that will be executed over the target device.</li>
<li>Once you have written your script, and before starting the task, you can save the script as
a template, so you can load it later if you want to run the same script again. Note that script
templates are stored linked to the device driver, so depending on the type of device you are
working on you will only see the relevant script templates. Use the <em>Save</em> and <em>Load</em>
buttons on the left of the code editor to load or save script templates.</li>
<li>As with any other task, you can start it immediately, or schedule it for a late execution or
as a repeating event. To do so, click on <em>Start as soon as possible</em>, this will expand and
you will be able to select advanced scheduling options.</li>
</ul>

<p>The entry point in the script is the <span class="code">run</span> function. This is what Netshot will
call, with the following parameters:</p>

<ul>
	<li><span class="code">cli</span>: an object to interact with the device through CLI.
	<ul>
		<li><span class="code">cli.macro(<i>macro</i>)</span>: use a macro to change mode as defined in the device driver.</li>
		<li><span class="code">cli.command(<i>command</i>)</span>: sends a command to the device and returns the result.</li>
	</ul>
	</li>
	<li><span class="code">device</span>: an object to change device's attributes.
	<ul>
		<li><span class="code">device.set(<i>attributeName</i>, <i>attributeValue</i>)</span>: change device's attributes,
		either standard or driver-specific attributes.</li>
	</ul>
	</li>
</ul>

<p>For example, the Cisco IOS driver defines the <span class="code">configure</span> macro which brings you
to the <em>configure</em> well-known mode, where you can enter configuration commands that will apply to the
running configuration. It also defines the <span class="code">end</span> macro to quit the <em>configure</em>
mode, and the <span class="code">save</span> macro to copy the running to the startup configuration. Thus
to change the description of interface <span class="code">GigabitEthernet0/0/16</span>, run the following
script:</p>

<p class="code">function run(cli, device) {
	cli.macro("configure");
	cli.command("interface GigabitEthernet0/0/16");
	cli.command("description New description");
	cli.macro("end");
	cli.macro("save");
}</p>

<p>The following script gets the actual OSPF router-id and writes it into the device comments:</p>

<p class="code">function run(cli, device) {
	cli.macro("enable");
	var protocols = cli.command("show ip protocols");
	var idPattern = /Routing Protocol is "ospf(.|\r|\n)+? Router ID ([0-9\.]+)/;
	var match;
	if (match = idPattern.exec(protocols)) {
		var rid = match[2];
		device.set("comments", "OSPF Router ID = " + rid);
	}
}</p>

<h2 id="compliance">Policy, rule and compliance</h2>

<p>The purpose of the <em>Compliance</em> section is to keep your devices in
a mastered state: any device not conforming to your own policies will
be flagged so you can act and fix it.</p>

<ul>
<li><em>Software rules</em> keep track of the running software versions of your devices.</li>
<li><em>Hardware rules</em> keep track of the hardware components in use in your network.</li>
<li><em>Configuration policies and rules</em> check the other attributes of the devices.</li>
</ul>

<p>Once the rules are defined within Netshot, the status of a device is refreshed
by running a <em>Check compliance</em> task. This can be done manually by scheduling
such a task, and anyway this is automatic after each snapshot task, to ensure
that a device becoming not compliant after a configuration change is immediately
flagged.</p>
<p>The software compliance status can be seen in the <a href="#devicecompliance">Compliance</a>
tab of the device view, or at the global level in the <a href="#reports">Software compliance report</a>.</p>


<p class="note">Creating, deleting or modifying policies or rules requires read-write permissions.</p>

<h3>Software rules</h3>

<p>The <em>software rules</em> are simple rules which assign a level (Gold, Silver or Bronze) to a device,
depending on its software version. The software version of a device, which can be seen in the 
<a href="#deviceinfo">General tab</a> of the device view, is written by the device driver during the
snaphots.</p>

<ul>
<li>A <em>Gold</em> level means the device is fully compliant with the software strategy.</li>
<li>A <em>Silver</em> level means the running software version is fine, but not the best choice.</li>
<li>A <em>Bronze</em> level means the running software version should be rolled out soon.</li>
</ul> 

<p>When evaluating the software compliance status of a device, the rules are processed in order
(from top to bottom as seen in the <em>Software version compliance</em> table). The first rule
whose criteria match the device's properties assigns its level to the device, and the process stops here.</p>

<p>If no rule is matched, then the device is non compliant.</p>


<p>To create a software rule, go to the <em>Compliance</em> main page, select the <em>Software</em> section
then click on the <em>+</em>.</p>

<ul>
<li>You can associate the rule with a specific device group, or to all devices.</li>
<li>You can select a device type (i.e. driver) or apply to all types.</li>
<li>In <em>Device family</em>, enter a string to be found in the device family. If you check the
<em>RegExp</em> box, the string will be interpreted as a regular expression, for more
flexibility.</li>
<li>In <em>Version</em>, enter a string to be found in the software version field of the device.
If you check the <em>RegExp</em> box, the string will be interpreted as a regular expression,
for more flexibility.</li>
<li>Eventually, select the level that will be assigned to any device matching all the criteria
defined above.</li>
</ul>

<p>You can reorder the rules by dragging and dropping a line in the <em>Software version compliance</em>
table.</p>

<h3>Hardware rules</h3>

<p><em>Hardware rules</em> aim at following up the support status of the hardware components
of devices. An hardware rule defines the end of sale and end of life (end of support) dates for
a specific part number. To evaluate the hardware support status of a device, Netshot
selects the earliest date for end of sale, and for end of life among the contained cards
(hardware modules).</p>

<p>To create an hardware rule, go to the <em>Compliance</em> page, select the <em>Hardware</em>
section, and click on <em>+</em> to add the rule.</p>

<ul>
<li>You can select a specific group the rule will apply to, or any group.</li>
<li>You can select a specific device type (i.e. driver) for the rule, or any type.</li>
<li>You can enter a <em>Device family</em>, string to be looked in the family assigned by the driver.
If you check the <em>RegExp</em> box, the string will be evaluated as a regular expression.</li>
<li>You have to enter a <em>part number</em>, to find modules (as populated by the driver during snaphots).</li>
<li>If all the previous criteria match for any module contained in the device, the end of sale
and end of life dates will be assigned to the device, unless an earlier date is already assigned.
You can let one of the two dates empty.</li>
</ul>

<h3>Configuration policies and rules</h3>

<p>Apart from <em>software</em> and <em>hardware</em> rules, you can create advanced rules that will
check the configuration or other attributes of the devices.</p>

<p>First you need to create a <em>policy</em>, which will contain the actual rules.
A policy applies to a group of devices. If you want to assign a policy to all devices,
just create a dynamic group without criteria, so it will contain all devices.</p>

<p>To create a policy, click on the <em>Create policy...</em> button in the main toolbar.
To edit or delete a policy, select it first, the buttons will appear.</p>

<p>Once you have the policy, select it and click on the <em>+</em> button to add a rule.
Note that the new rule is disabled by default, you have to edit it to enable it.</p>

<p>To edit a rule, select it and click on the <em>Edit</em> (wrench icon) button.
You can enable or disable it, and add exemptions. To add an exemption, enter the
name of the device in the search field, select the device among the results,
select the end-of-exemption date, and click on the arrow button.</p>

<p>A rule will check the device attributes and return one of the following:</p>
<ul>
<li><em>CONFORMING</em>: the device conforms to the policy.</li>
<li><em>NONCONFIRMING</em>: the device doesn't conform to the policy.</li>
<li><em>NOTAPPLICABLE</em>: the rule doesn't apply to the device.</li>
<li><em>DISABLED</em>: the rule is currently disabled.</li>
<li><em>EXEMPTED</em>: there is an exemption for this device and this rule.</li>
<li><em>INVALIDRULE</em>: this could happen if a rule script has syntax errors.</li>
</ul>

<p>There are two types of rules: text-based (or regular expression) rules
and script-based (Javascript) rules.</p>

<h4>Text-based rules</h4>

<p>Text-based rules just check that a specific attribute of the device
(most of the time, the running configuration) matches some text, or a regular
expression.</p>

<img alt="Text-based rules" src="img/compliance_textrule.png" class="figure" />

<ul>
<li>Select the type of device (the driver). For devices of another type,
the result of the rule checking will be NOTAPPLICABLE.</li>
<li>Select the field to check. This depends on the selected type of device.</li>
<li>The context is a hierarchy of regular expressions to find a specific
block within the text attribute .</li>
<li>The identified blocks will have to match the text provided in the main textbox.</li>
<li>This text can be interpreted as a regular expression by checking
the relevant box.</li>
</ul>

<p>For example, in Cisco IOS if you want all interfaces to have a description,
define a rule as follows:</p>

<ul>
<li>Device type: <em>Cisco IOS and IOS-XE</em></li>
<li>Field: <em>Running configuration</em></li>
<li>Context: <span class="code">^interface .*</span></li>
<li><em>All blocks</em></li>
<li>Text (Regular expression): <span class="code">^ *description .+</span></li>
<li><em>The text must exist</em></li>
</ul>

<p>Other example, in IOS-XR, if you want all GigabitEthernet interfaces of OSPF
to be configured as point-to-point:</p>

<ul>
<li>Device type: <em>Cisco IOS-XR</em></li>
<li>Field: <em>Configuration</em></li>
<li>Context: <p class="code">^router ospf .*
^ *area .*
^ *interface GigabitEthernet.*</p></li>
<li><em>All blocks</em></li>
<li>Text (Regular expression): <span class="code">(?m)^ *network point-to-point$</span>
(<span class="code">(?m)</span> is to enable the multiline mode in the regular expression)</li>
<li><em>The text must exist</em></li>
</ul>

<h4>Script-based rules</h4>

<p>The script-based rules are Javascript code.</p>

<p>Click on <em>Edit the script...</em> to open up the JavaScript editor. While
you are writing your script, you can test it on a specific device by selecting
a device at the bottom of the editor and clicking on <em>Test...</em>.
Click on the underlined result to see the logs.</p>

<p>Here is a basic (and useless) rule, which will set all devices compliant:<p>

<p class="code">function check(device) {
    return CONFORMING;
}</p>

<p>The function <span class="code">check(<i>device</i>, [<i>debug</i>])</span> must exist
in the code, this is the entry point, which will be called whenever the device
must be validated by the rule.</p>

<ul>
	<li><span class="code"><i>device</i></span> is an object to access data of the device
	being checked, and some util functions.
	<ul>
		<li><span class="code">device.get(<i>attribute</i>)</span> allows you to retrieve
		an attribute of the device, so you can make further validation on it.
		The attribute can be of:
		<ul>
			<li><span class="code">"type"</span>, the driver of the device.</li>
			<li><span class="code">"name"</span>, the name of the device.</li>
			<li><span class="code">"family"</span>, the family of the device.</li>
			<li><span class="code">"location"</span>, the location of the device.</li>
			<li><span class="code">"contact"</span>, the contact for the device.</li>
			<li><span class="code">"softwareVersion"</span>, the OS version of the device.</li>
			<li><span class="code">"serialNumber"</span>, the main serial number of the device.</li>
			<li><span class="code">"networkClass"</span>, the class of the device (e.g. ROUTER, SWITCH, FIREWALL, etc.).</li>
			<li><span class="code">"virtualDevices"</span>, an array of names of the vitual devices embedded
				in this device (e.g. the list of VDC names for a Cisco Nexus device).</li>
			<li><span class="code">"vrfs"</span>, an array of names of the VRFs configured on the device.</li>
			<li><span class="code">"interfaces"</span>, the list of interfaces of the device.</li>
			<li>Any other attribute name defined by the <a href="#devicedrivers">driver</a> of the device.</li>
		</ul>
		</li>
		<li><span class="code">device.get(<i>attribute</i>, <i>otherDevice</i>)</span>,
		where <span class="code"><i>otherDevice</i></span> is either the ID or the name
		of another device, will retrieve for you the given attribute value from the
		specified device instead of the current device. By using this feature, you
		can compare configurations between devices.</li>
		<li><span class="code">device.nslookup(<i>host</i>)</span> will return a
		DNS resolution (either direct or reverse) of the passed name.</li>
		<li><span class="code">device.findSections(<i>configuration</i>, <i>section</i>)</span>,
		where <span class="code"><i>text</i></span> is a String and
		<span class="code"><i>section</i></span> is a JavaScript RegExp object, will find
		in <span class="code"><i>configuration</i></span> all
		lines matching <span class="code"><i>section</i></span>, and will return them
		along with their content, i.e. following lines which are more indented.</li> 
	</ul>
	<li><span class="code">debug(<i>message</i>)</span> is a function that you can call
	to log debug messages. These messages will appear in the logs of the
	<em>Check compliance</em> task.</li>
</ul>

<p>The <span class="code">check</span> function must return one of the following
special values:<p>
<ul>
	<li><span class="code">CONFORMING</span></li>
	<li><span class="code">NONCONFORMING</span></li>
	<li><span class="code">NOTAPPLICABLE</span></li>
</ul>

<p>You can also return the same value along with a text message, that would
appear in the device compliance status, mainly to indicate why the device
was not compliant:<p>

<p class="code">return {
    result: NONCONFORMING,
    comment: "VTY ACL not applied"
};</p>

<h2 id="reports">Reports</h2>

<p>The <em>Reports</em> section gives an overview of the network status by
aggregating data collected by the other modules.</p>

<h3>Configuration changes</h3>

<p>The <em>Configuration changes</em> report shows the configuration changes
detected by Netshot over the last hours or days, or on a precise day.</p>

<img alt="Configuration changes" src="img/report_changes.png" class="figure" />

<p>Note that the change date/time is the moment when Netshot took the snapshot,
not the precise time of the change itself. Even if the snapshot was
automatically taken after a detection of the change, it occurred several
minutes after the actual change. Also, if several changes were made to the
configuration of the devices within a few minutes, Netshot probably saw a single
change only.</p>

<h3>Device access failures</h3>

<p>The <em>Device access failures</em> report lists the devices which haven't
been successfully backed up by a snapshot task for the last X days, where X can
be selected using the numeric field (3 by default). Change the number of days
and click the <em>Update</em> button to refresh the list.</p>

<p class="note">The disabled devices are excluded from the list.</p>

<p>The purpose of this report is to easily identify which devices are not
responding to Netshot snapshot attempts anymore.</p>



<h3>Configuration compliance</h3>

<p>This report gives the compliance percentage for device groups. A device
is flagged as non compliant so long as it doesn't pass at least one rule.</p>
<p>If you click on a group, you'll see the list of non conforming devices.</p>

<p class="note">If a <a href="#devicegroups">group of devices</a> doesn't appear
in the compliance reports, this is probably because it was marked as <em>hidden</em>.
Edit it in the <a href="#devices">Devices</a> section to change this.</p>

<h3>Software compliance</h3>

<p>This report will give you, for each group of devices, the percentage of
Gold, Silver, Bronze and non compliant devices, resulting from the software
rules defined in the <a href="#compliance">Compliance</a> section.</p>

<p>Click on a category in the legends to display the matching devices at
the bottom of the page.</p>

<h3>Hardware support status</h3>

<p>This report will give the trend of hardware support with time. This is based
on end of sale and end of life dates that you have defined for part numbers
in the <a href="#compliance">Compliance</a> section. When an hardware module
becomes end of sale (or life), any device with such a module becomes itself end
of sale (of life). The graph in the <em>Hardware support</em> report gives
the number of end of sale and end of life devices, increasing with time.
The milestones (dates when bunches of devices become end of sale or life) are
listed below the table. If you click on the number of devices, you'll get
the actual corresponding devices.</p>

<h3>Data export</h3>

<p>You can export data collected by Netshot into an Excel file.</p>
<p>The options are self-explanatory. Click on <em>Download the result</em>
to generate and get the file. The generation of the file could take a few
minutes if there are many devices in the database.</p>

<h2 id="tasks">Tasks</h2>

<p>In the <em>Tasks</em> section, you can see the current tasks, and also
schedule global tasks.</p>

<p>You can see the <em>running</em>, <em>scheduled</em> (waiting), <em>succeeded</em>,
<em>failed</em>, <em>cancelled</em> tasks, by clicking on the proper tab.
For the passed tasks, today's tasks only are displayed by default, but you
can select another day to see the history.</p>
<p>Click on the first button to refresh the list of tasks.</p>
<p>You can schedule a global task by clicking on <em>Schedule...</em> in the
main toolbar.</p>

<p>If you want to look at the task history of a specific device, you can see it
in the <em>Task</em> tab of the device in the <a href="#devices">Devices</a> view.</p>

<h2 id="admin">Administration</h2>

<h3 id="netshotconf">Netshot configuration file</h3>

<p>Some global options can be configured in the <em>Netshot configuration file</em>.</p>

<p>When started, Netshot will try to find and read a file called <span class="code">netshot.conf</span>
in the current directory, then <span class="code">/etc/netshot.conf</span> if the first one wasn't found.
If this file is not found at all, Netshot won't start.</p>

<p>In the configuration file, each line must be of the form:</p>

<p class="code"><i>parameter</i> = <i>value</i></p>

<p>If a line starts with <span class="code">#</span>, it will be ignored.</p>

<p>Netshot needs to be restarted after a change to the configuration file so
the new parameters are taken into account.</p>


<h4>Logging configuration</h4>

<ul>
	<li><span class="code">netshot.log.file = /var/log/netshot/netshot.log</span>:
	sets the location and name of the main Netshot log file. Log files will be
	automatically rotated (see next settings). The default is
	<span class="code">netshot.log</span> (current directory).</li>
	<li><span class="code">netshot.log.file = CONSOLE</span>: for debugging
	purpose, lets Netshot output its logs directly to stdout.</li>
	<li><span class="code">netshot.log.maxsize = 1</span>: sets the maximum
	size of the log file to 1MB. The default is 2. The log file will rotated
	when reaching this size.</li>
	<li><span class="code">netshot.log.count = 10</span>:
	sets the number of log files to keep. The default is 5.</li>
	<li><span class="code">netshot.log.level = INFO</span>:
	sets the global level of logs to send to the file. The default is WARN. The possible
	values are OFF, ERROR, WARN, INFO, DEBUG, TRACE, ALL. Changing this level
	might create lots of logs.</li>
	<li><span class="code">netshot.log.class.<i>ClassName</i> = DEBUG</span>:
	sets the log level of a specific class ClassName to a custom level. This
	obviously requires some knowledge of the Netshot internal code.</li>
</ul>

<h4>Database configuration</h4>

<ul>
	<li><span class="code">netshot.db.url = jdbc:mysql://server/netshot01</span>:
	sets the URI to access the Netshot database.</li>
	<li><span class="code">netshot.db.username = user1</span>: sets the username
	to be used to access the database.</li>
	<li><span class="code">netshot.db.password = pass1</span>: sets the password
	to be used to access the database.</li>
</ul>

<h4>Embedded HTTP server</h4>

<ul>
	<li><span class="code">netshot.http.ssl.keystore.file = /usr/local/netshot/netshot.jks</span>:
	sets the location of the keystore containing the SSL certificate for the
	embedded HTTPS server. The default is <span class="code">netshot.jks</span>
	in the current directory. Netshot can't start without this file.</li>
	<li><span class="code">netshot.http.ssl.keystore.pass = pass2</span>:
	sets the password of the keystore containing the SSL certificate for
	the embedded HTTPS server. The default is <span class="code">netshotpass</span>.</li>
	<li><span class="code">netshot.http.baseport = 9443</span>: sets the TCP
	port of the embedded HTTPS server. The default is 8443.</li>
</ul>

<h4 id="syslogserver">Syslog server</h4>

<p>The embedded Syslog server listens for Syslog messages to detect when
changes are made on devices.</p>

<ul>
	<li><span class="code">netshot.syslog.port = 1514</span>: sets the UDP port
	to listen Syslog messages on. The default is 514, which requires root
	permissions under Linux.</li>
	<li><span class="code">netshot.syslog.disabled = true</span>: disables
	the embedded Syslog server. It is enabled by default</li>
</ul>

<p>You can choose to make Netshot listen for Syslog on port 1514 (non root user)
and use iptables to rewrite the destination port. See the installation
guide.</p>

<h4 id="snmptrapreceiver">SNMP trap receiver</h4>

<p>The embedded SNMP trap receiver listens for SNMP traps to detect changes
on devices.</p>

<ul>
	<li><span class="code">netshot.snmptrap.port = 1162</span>: sets the UDP port
	to listen SNMP traps on. The default is 162, which requires root permissions
	under Linux.</li>
	<li><span class="code">netshot.snmptrap.community = public</span>: sets the
	SNMP community of the traps sent to Netshot for change detection. The
	default is "NETSHOT".</li>
	<li><span class="code">netshot.snmptrap.disabled = true</span>: disables
	the embedded SNMP trap receiver. It is enabled by default</li>
</ul>

<p>You can choose to make Netshot listen for SNMP traps on port 1162 (non root user)
and use iptables to rewrite the destination port. See the installation guide.</p>

<h4>User authentication</h4>

<ul>
	<li><span class="code">netshot.aaa.radius1.ip = 1.2.3.4</span>,
	<span class="code">netshot.aaa.radius1.authport = 1812</span>,
	<span class="code">netshot.aaa.radius1.secret = MyKey#1</span>: defines
	the first RADIUS server to be used for user authentication.</li>
	<li><span class="code">netshot.aaa.maxidletime = 1200</span>: sets the maximum
	idle time for a logged in user, after which he/she will be disconnected. In
	seconds. The default is 1800.</li>
</ul>

<h4>Drivers</h4>

<ul>
	<li><span class="code">netshot.drivers.path = /usr/local/netshot/drivers</span>:
	defines a directory where to look for additional <a href="devicedrivers">device driver</a> files.
	By default, Netshot will only use the embedded drivers (in .jar file).</li>
</ul>

<h4>Snapshots</h4>

<ul>
	<li><span class="code">netshot.snapshots.dump = /usr/local/netshot/configs</span>:
	defines a directory where to save device configurations after each snapshot
	task. By default, no directory is device, so no dump will be done.</li>
	<li><span class="code">netshot.snapshots.auto.interval = 16</span>:
	sets the time (in minutes) to wait after a change is detected on a device,
	before starting a snapshot. The default is 10 minutes.</li>
	<li><span class="code">netshot.snapshots.auto.anyip = true</span>:
	tells Netshot to look at non-management IP addresses to identify a device
	sending a trap or a Syslog message, when the source IP address of the
	message is not a known management IP address in Netshot. This feature
	is disabled by default</li>
</ul>

<h4>General</h4>

<ul>
	<li><span class="code">netshot.tasks.threadcount = 16</span>: the number
	of tasks that can be executed concurrently. The default is 10.</li>
</ul>


<h3 id="authentication">Authentication</h3>

<p>Netshot supports both local and remote accounts. Local means the authentication process stays local to Netshot
(the user is stored in the local database) while remote means that authentication is delegated to a RADIUS server.</p>

<p>When an user tries to log into Netshot, Netshot first looks for a <em>local</em> account in the database.
If the local account exists, it checks the password and accepts or denies the user based on that, with the assigned permission level.
If the local account doesn't exist, and at least one RADIUS server is configured, Netshot will try a RADIUS challenge.
If RADIUS fails, then the user is rejected. If it succeeds, the user is allowed as visitor by default.
If the RADIUS response contains a Service-Type attribute equals to <em>AdministrativeUser</em> (well known value),
then the user is allowed as admin. If the Service-Type attribute equals to <em>NASPromptUser</em> then the user gets
read-write permissions.
However if the user exists in the database as <em>remote</em> user, and has been successfully authenticated by RADIUS, then the permission level
locally assigned to the account will override the RADIUS-provided level.</p>

<p>To enable local authentication, simply create <em>local</em> accounts in the Admin page.</p>
<p>To enable RADIUS authentication, you have to declare the server(s) in the Netshot configuration file.
You can have up to 3 servers. They will be tried one by one until one responds. For instance:</p>

<p class="code"> netshot.aaa.radius1.ip = 1.2.3.4
 netshot.aaa.radius1.authport = 1812
 netshot.aaa.radius1.secret = MyKey#1
 netshot.aaa.radius2.ip = 1.2.3.5
 netshot.aaa.radius2.authport = 1812
 netshot.aaa.radius2.secret = MyKey#1</p>


<h3 id="devicedomain">Device domains</h3>

<p>When adding a device to Netshot, you must associate it with a <em>management domain</em>.
A management domain defines a set of parameters that will apply to the associated
devices.</p>

<ul>
	<li>The IP address defined in the management domain is the IP address
	of the Netshot server as seen by the devices of the domain. This can be
	useful in drivers which use FTP/TFTP to upload configuration items to
	Netshot.</li>
	<li>When creating device credential sets, you can assign them to a specific
	management domain. In that case, only the devices of the domain will use
	these credential sets.</li>
</ul>

<p>The device domains are created in the Admin page. A domain can't be deleted if it contains any device
or is associated to a specific credential set.</p>


<h3 id="credentials">Device credentials</h3>

<p>The credentials used to access devices are globally managed from the Admin page.</p>

<p>You can create SNMP v1, SNMP v2c, Telnet and SSH (versions 1.5, 1.99 or 2.0) credential sets. SNMP v3 is not
supported at the moment.</p>

<p>The SSH authentication can either use a simple password, or can be key-based. To add an SSH key credential set,
you need the public and the private RSA key couple. Assuming you've generated the keys using <code>ssh-keygen</code>,
just copy and paste the content of the files, <span class="code">~/.ssh/id_rsa</span> (private key) and
<span class="code">~/.ssh/id_rsa.pub</span> (public key).</p>

<p class="note">The credentials as stored in clear text in the Netshot database, so it's important to ensure
the access to the Netshot database and to its hosting server is properly secured.</p>

<p>If you associate the
credential set to a management domain, it will automatically be used only by the devices of the domain.
If you don't specify a management domain, any device will be able to use it.</p>

<p>When adding a device to Netshot, the available credential sets will be tried in turn.
The working credential set will be saved as the main one for the device.</p>

<h3>Device types</h3>

<p>The Admin page lets the administrator dynamically reload the <a href="#devicedrivers">Javascript driver files</a>.</p>
<p>By clicking on the <em>Reload the drivers</em> button, the driver files will be scanned
and reloaded, so any change made to them will be taken into account by Netshot.</p>



<h2 id="devicedrivers">Device drivers</h2>

<p>Each supported type of device in Netshot rely on a single JavaScript file, which
is often called <em>driver</em>. This file describes the special attributes of
the device type (e.g. running config and configuration register for a Cisco IOS
device), and contains runnable code that will be executed when interacting with the
device (e.g. taking a snapshot of the device).

<h3>Driver location</h3>

<p>The Netshot package (especially the .jar file) contains several built-in
drivers for some well known network device operating systems. These drivers
are automatically loaded from the package without further action, which
makes Netshot able to manage most of the router and switch devices out of the
box.</p>
<p>Netshot also automatically loads drivers from the file system, which allows
you to add your own driver files, by placing them in the directory defined
in the <a href="#netshotconf">Netshot configuration file</a> by
<span class="code">netshot.drivers.path</span>.</p>
<p>If you want to make changes to an existing built-in driver, you can extract it
from the .jar file, and copy it to the driver directory. The driver loaded from
the file system has priority over the built-in driver.</p>

<p>The drivers can by dynamically reloaded while Netshot runs from the
<a href="#admin">page</a>.</p>

<h3>Driver structure</h3>

<p>A driver is a JavaScript file.</p>

<p>A driver must contain the following global objects:</p>

<ul>
	<li><span class="code">Info</span>: object describing the driver.</li>
	<li><span class="code">Device</span>: object describing the specific attributes
	of this type of device.</li>
	<li><span class="code">Config</span>: object describing the attributes
	of a configuration of a device of this type (an history of these attributes
	will be kept, as opposed to the device attributes).</li>
	<li><span class="code">CLI</span>: object containing the logic to
	interact with the device's CLI, as a state machine.</li>
	<li><span class="code">snapshot(cli, device, config, debug)</span>: a
	function to be called each time a snapshot on a device of this type is started.</li>
	<li><span class="code">analyzeSyslog(message)</span>: function which will
	be automatically called whenever a Syslog message is received. The function
	must return true if it recognizes a configuration change notification for the
	type of device it supports.</li>
	<li><span class="code">analyzeTrap(trap)</span>: function which will be
	automatically called whenever a trap message is received (with the right
	community). The function must return true if it recognizes a configuration
	change notification for the specific type of device it supports.</li>
	<li><span class="code">snmpAutoDiscover(sysObjectID, sysDesc)</span>:
	function which will be called when a device is added to Netshot in
	autodiscovery mode. The driver will have to look at the sysObjectID and
	sysDesc and return true if it thinks it can support this device. If it
	returns true, Netshot will effectively add the device to the database, and
	assigns this driver to the device for future actions.
</ul> 





















</div>

</body>
</html>